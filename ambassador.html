<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AZ Learner - Ambassador Portal</title>
    <link rel="icon" type="image/png" href="favicon1.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Roboto', 'sans-serif'] },
                    colors: {
                        blueAccent: '#448AFF',
                        orangeAccent: '#FFAB40',
                        darkBg: '#111827',
                        darkCard: '#2d2d2d',
                        success: '#00E676'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            -webkit-tap-highlight-color: transparent;
            background: linear-gradient(-45deg, #020617, #0f172a, #1e3a8a, #172554);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: white;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 3px;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="font-sans antialiased h-screen flex flex-col">

    <!-- Auth Overlay -->
    <div id="auth-overlay" class="fixed inset-0 z-[100] bg-gray-900 flex flex-col items-center justify-center p-6">
        <div class="w-full max-w-sm glass-panel p-8 rounded-2xl shadow-2xl text-center">
            <div class="text-6xl mb-4">ðŸŽ“</div>
            <h1 class="text-3xl font-black text-orangeAccent mb-2 tracking-tighter">Ambassador Portal</h1>
            <p class="text-sm text-gray-400 mb-6">Access Restricted to Ambassadors & Admins</p>
            <input type="email" id="login-email" placeholder="Email"
                class="w-full mb-3 p-3 rounded-lg bg-gray-700 outline-none text-white border border-gray-600 focus:border-orangeAccent transition-colors">
            <input type="password" id="login-pass" placeholder="Password"
                class="w-full mb-6 p-3 rounded-lg bg-gray-700 outline-none text-white border border-gray-600 focus:border-orangeAccent transition-colors">
            <button onclick="authManager.login()"
                class="w-full py-3 bg-gradient-to-r from-orangeAccent to-orange-600 text-white font-bold rounded-xl shadow-lg active:scale-95 transition-transform mb-4">
                Enter Portal ðŸš€
            </button>
            <p id="login-msg" class="text-red-500 text-xs h-4"></p>
            <div class="mt-6 pt-6 border-t border-gray-700">
                <a href="index.html" class="text-gray-400 hover:text-white text-sm transition">
                    <i class="fas fa-arrow-left"></i> Back to Home
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="app-content" class="hidden flex-1 flex flex-col h-full">
        <!-- Header -->
        <div class="glass-panel border-b border-gray-700/50 px-6 py-4 flex justify-between items-center shrink-0 shadow-md z-10">
            <div>
                <h1 class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orangeAccent to-yellow-200">
                    AZ AMBASSADOR PORTAL
                </h1>
                <p id="user-name-display" class="text-xs text-gray-400 font-mono">Loading...</p>
            </div>
            <button onclick="authManager.logout()"
                class="bg-gray-700 hover:bg-red-900/80 text-white px-4 py-2 rounded-lg text-xs font-bold transition flex items-center gap-2">
                Sign Out <i class="fa-solid fa-power-off"></i>
            </button>
        </div>

        <!-- Tab Navigation -->
        <div class="glass-panel border-b border-gray-700/50 px-4 py-2 overflow-x-auto flex gap-2 shrink-0 z-10">
            <button onclick="portal.switchTab('profile')" id="tab-profile" 
                class="portal-tab px-4 py-2 rounded text-xs font-bold transition bg-blueAccent text-white whitespace-nowrap">
                <i class="fa-solid fa-user"></i> Profile
            </button>
            <button onclick="portal.switchTab('programs')" id="tab-programs" 
                class="portal-tab px-4 py-2 rounded text-xs font-bold transition text-gray-400 hover:text-white whitespace-nowrap">
                <i class="fa-solid fa-calendar"></i> Programs
            </button>
            <button onclick="portal.switchTab('courses')" id="tab-courses" 
                class="portal-tab px-4 py-2 rounded text-xs font-bold transition text-gray-400 hover:text-white whitespace-nowrap">
                <i class="fa-solid fa-book"></i> Courses
            </button>
            <button onclick="portal.switchTab('leaderboard')" id="tab-leaderboard"
                class="portal-tab px-4 py-2 rounded text-xs font-bold transition text-gray-400 hover:text-white whitespace-nowrap">
                <i class="fa-solid fa-trophy"></i> Leaderboard
            </button>
        </div>

        <!-- Tab Content -->
        <div class="flex-1 overflow-y-auto p-4 md:p-6">
            
            <!-- Profile Tab -->
            <div id="view-profile" class="portal-view">
                <div class="max-w-4xl mx-auto space-y-6">
                    <div class="glass-panel rounded-2xl p-8">
                        <div class="flex items-center gap-6 mb-6">
                            <div class="w-24 h-24 bg-gradient-to-br from-orangeAccent to-orange-600 rounded-full flex items-center justify-center text-4xl font-bold">
                                <span id="profile-initials">?</span>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-white" id="profile-name">Loading...</h2>
                                <p class="text-gray-400" id="profile-email">Loading...</p>
                                <div class="mt-2">
                                    <span class="bg-orange-900/30 text-orange-400 px-3 py-1 rounded-full text-xs font-bold" id="profile-role">Ambassador</span>
                                </div>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="text-sm font-bold text-gray-400 uppercase mb-3">Academic Information</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">University:</span>
                                        <span class="text-white font-bold" id="profile-university">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">Major:</span>
                                        <span class="text-white" id="profile-major">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">Year:</span>
                                        <span class="text-white" id="profile-year">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">GPA:</span>
                                        <span class="text-white" id="profile-gpa">-</span>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <h3 class="text-sm font-bold text-gray-400 uppercase mb-3">Contact Information</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">Phone:</span>
                                        <span class="text-white" id="profile-phone">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">Date of Birth:</span>
                                        <span class="text-white" id="profile-dob">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">Social Media:</span>
                                        <span class="text-white" id="profile-social">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 pt-6 border-t border-gray-700">
                            <h3 class="text-sm font-bold text-gray-400 uppercase mb-3">Ambassador Status</h3>
                            <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-check-circle text-green-400 text-2xl"></i>
                                    <div>
                                        <p class="text-white font-bold">Active Ambassador</p>
                                        <p class="text-xs text-gray-400" id="profile-approved">Approved on: Loading...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="glass-panel rounded-xl p-6">
                            <div class="flex items-center gap-3">
                                <div class="bg-blue-500/20 p-3 rounded-lg">
                                    <i class="fas fa-calendar text-blue-400 text-2xl"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-400">Programs Attended</p>
                                    <p class="text-2xl font-bold text-white" id="stat-programs">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="glass-panel rounded-xl p-6">
                            <div class="flex items-center gap-3">
                                <div class="bg-orange-500/20 p-3 rounded-lg">
                                    <i class="fas fa-book text-orange-400 text-2xl"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-400">Courses Available</p>
                                    <p class="text-2xl font-bold text-white" id="stat-courses">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="glass-panel rounded-xl p-6">
                            <div class="flex items-center gap-3">
                                <div class="bg-green-500/20 p-3 rounded-lg">
                                    <i class="fas fa-trophy text-green-400 text-2xl"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-400">Achievement Points</p>
                                    <p class="text-2xl font-bold text-white">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Programs Tab -->
            <div id="view-programs" class="portal-view hidden">
                <div class="max-w-4xl mx-auto space-y-6">
                    <div class="glass-panel rounded-2xl p-8">
                        <h2 class="text-2xl font-bold text-white mb-2">
                            <i class="fas fa-calendar-alt"></i> Ambassador Programs
                        </h2>
                        <p class="text-gray-400 text-sm mb-6">View and join upcoming programs and events</p>
                        
                        <div id="programs-list" class="space-y-4">
                            <div class="text-center text-gray-500 py-8">Loading programs...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Courses Tab -->
            <div id="view-courses" class="portal-view hidden">
                <div class="max-w-4xl mx-auto space-y-6">
                    <div class="glass-panel rounded-2xl p-8">
                        <h2 class="text-2xl font-bold text-white mb-2">
                            <i class="fas fa-graduation-cap"></i> Training & Resources
                        </h2>
                        <p class="text-gray-400 text-sm mb-6">Access exclusive ambassador training materials</p>
                        
                        <div id="courses-grid" class="grid md:grid-cols-2 gap-6">
                            <div class="text-center text-gray-500 py-8 col-span-2">Loading courses...</div>
                        </div>

                        <div class="mt-8 p-6 bg-blue-900/20 border border-blue-500/30 rounded-xl">
                            <h3 class="text-lg font-bold text-white mb-2">
                                <i class="fas fa-download"></i> Resource Library
                            </h3>
                            <p class="text-sm text-gray-400 mb-4">Download ambassador guides, templates, and promotional materials</p>
                            <a href="courses.html" target="_blank" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition">
                                Browse Resources
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Tab -->
            <div id="view-leaderboard" class="portal-view hidden">
                <div class="max-w-4xl mx-auto space-y-6">
                    <div class="glass-panel rounded-2xl p-8">
                        <h2 class="text-2xl font-bold text-white mb-2">
                            <i class="fas fa-trophy"></i> Ambassador Leaderboard
                        </h2>
                        <p class="text-gray-400 text-sm mb-6">Top ambassadors ranked by achievement points</p>
                        <div id="leaderboard-list" class="space-y-3">
                            <div class="text-center text-gray-500 py-8">Loading leaderboard...</div>
                        </div>
                    </div>

                    <!-- Monthly Challenge Banner -->
                    <div class="glass-panel rounded-2xl p-6 border border-yellow-500/30">
                        <div class="flex items-start gap-4">
                            <div class="bg-yellow-500/20 p-3 rounded-lg shrink-0">
                                <i class="fas fa-fire text-yellow-400 text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-white mb-1">Monthly Challenge â€” February 2026</h3>
                                <p class="text-sm text-gray-400 mb-3">Complete all tasks this month to earn a bonus badge and 500 extra points.</p>
                                <div class="space-y-2">
                                    <div class="flex items-center gap-2 text-sm">
                                        <i class="fas fa-circle-check text-green-400"></i>
                                        <span class="text-gray-300">Complete one training course</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-sm">
                                        <i class="fas fa-circle text-gray-600"></i>
                                        <span class="text-gray-400">Recruit 3 new AZ Learner users</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-sm">
                                        <i class="fas fa-circle text-gray-600"></i>
                                        <span class="text-gray-400">Attend a campus program or event</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Course Detail Modal -->
    <div id="course-modal" class="fixed inset-0 z-[200] bg-black/70 backdrop-blur-sm hidden flex items-start justify-center p-4 overflow-y-auto">
        <div class="w-full max-w-2xl glass-panel rounded-2xl shadow-2xl mt-8 mb-8">
            <div id="course-modal-header" class="p-6 border-b border-gray-700 flex justify-between items-start">
                <div class="flex items-center gap-4">
                    <div id="course-modal-icon-wrap" class="p-3 rounded-lg">
                        <i id="course-modal-icon" class="fas fa-book text-2xl"></i>
                    </div>
                    <div>
                        <h2 id="course-modal-title" class="text-xl font-bold text-white"></h2>
                        <p id="course-modal-desc" class="text-sm text-gray-400 mt-1"></p>
                    </div>
                </div>
                <button onclick="portal.closeCourseModal()" class="text-gray-400 hover:text-white text-2xl leading-none ml-4">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <h3 class="text-sm font-bold text-gray-400 uppercase mb-4">Course Modules</h3>
                <div id="course-modal-modules" class="space-y-3"></div>
                <div class="mt-6 pt-6 border-t border-gray-700 flex gap-3">
                    <button onclick="portal.closeCourseModal()" class="flex-1 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white text-sm font-bold transition">
                        Close
                    </button>
                    <button id="course-modal-start-btn" class="flex-1 py-2 rounded-lg bg-blueAccent hover:bg-blue-600 text-white text-sm font-bold transition">
                        Start Learning
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Integration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, onSnapshot, orderBy, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCKpJ7YzuHMTaTC3jXFWiEPmuwdTU4h96Y",
            authDomain: "az-learner.firebaseapp.com",
            projectId: "az-learner",
            storageBucket: "az-learner.firebasestorage.app",
            messagingSenderId: "12958795950",
            appId: "1:12958795950:web:326411293864571040453f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let currentUser = null;
        let isAmbassador = false;

        const HARDCODED_COURSES = [
            {
                id: 'marketing-outreach',
                title: 'Marketing & Outreach',
                description: 'Learn how to effectively promote AZ Learner on campus and grow your community.',
                color: 'blue',
                icon: 'bullhorn',
                duration: '2 hrs',
                isPublished: true,
                modules: [
                    {
                        order: 1,
                        title: 'Understanding Your Audience',
                        type: 'text',
                        content: 'Identify your campus demographics, map student pain points, and craft messages that resonate with different peer groups. Learn how to segment your audience by faculty, year group, and interest to deliver the right message at the right time.'
                    },
                    {
                        order: 2,
                        title: 'Social Media Strategy',
                        type: 'text',
                        content: 'Build a content calendar for Instagram, TikTok, and WhatsApp to grow AZ Learner visibility on campus. Learn best practices for each platform, how to create short-form video content, and how to measure engagement to improve future posts.'
                    },
                    {
                        order: 3,
                        title: 'On-Campus Activation',
                        type: 'text',
                        content: 'Plan and run tabling events, peer-to-peer demos, and referral drives. Learn how to set up an eye-catching booth, demo the app to sceptical students, and collect sign-ups effectively using your unique referral code.'
                    }
                ]
            },
            {
                id: 'leadership-development',
                title: 'Leadership Development',
                description: 'Develop the skills to lead study groups, mentor peers, and grow as a campus leader.',
                color: 'orange',
                icon: 'users',
                duration: '2.5 hrs',
                isPublished: true,
                modules: [
                    {
                        order: 1,
                        title: 'Effective Study-Group Facilitation',
                        type: 'text',
                        content: 'Learn how to lead productive study groups and keep participants engaged throughout a session. Discover techniques for setting clear agendas, managing time, dealing with dominant or disengaged members, and making every participant feel valued.'
                    },
                    {
                        order: 2,
                        title: 'Mentoring Peers',
                        type: 'text',
                        content: 'Build trust with fellow students, give constructive feedback, and help them set realistic academic goals. Explore active listening, motivational techniques, and how to identify when a peer needs extra support beyond academic guidance.'
                    },
                    {
                        order: 3,
                        title: 'Managing Conflict',
                        type: 'text',
                        content: 'Learn to resolve disputes fairly and maintain a positive ambassador team culture. Understand the root causes of interpersonal conflict, practice de-escalation strategies, and know when to escalate issues to the AZ Learner core team.'
                    }
                ]
            },
            {
                id: 'communication-skills',
                title: 'Communication Skills',
                description: 'Master public speaking, written communication, and active listening to engage your campus.',
                color: 'green',
                icon: 'comments',
                duration: '2 hrs',
                isPublished: true,
                modules: [
                    {
                        order: 1,
                        title: 'Public Speaking Fundamentals',
                        type: 'text',
                        content: 'Structure a short talk, control nerves, and make a strong first impression. Practice the PREP framework (Point, Reason, Example, Point) for impromptu and prepared speeches, and learn how body language amplifies your message.'
                    },
                    {
                        order: 2,
                        title: 'Written Communication',
                        type: 'text',
                        content: 'Craft clear emails, WhatsApp messages, and social-media captions that get results. Learn the principles of plain language, how to write a compelling call to action, and common mistakes that make professional communication less effective.'
                    },
                    {
                        order: 3,
                        title: 'Active Listening',
                        type: 'text',
                        content: 'Understand student feedback deeply and respond with empathy. Active listening is more than hearing words â€” it is about understanding intent, asking clarifying questions, summarising what you heard, and validating the speaker\'s perspective before responding.'
                    }
                ]
            },
            {
                id: 'event-planning',
                title: 'Event Planning',
                description: 'Organise impactful study sessions, campus events, and AZ Learner activations.',
                color: 'purple',
                icon: 'calendar-check',
                duration: '2 hrs',
                isPublished: true,
                modules: [
                    {
                        order: 1,
                        title: 'Event Ideation & Scoping',
                        type: 'text',
                        content: 'Choose the right event type, set clear goals, and define your target audience before you begin planning. Learn how to do a quick feasibility check â€” budget, venue availability, expected attendance â€” so you only invest time in events that can actually happen.'
                    },
                    {
                        order: 2,
                        title: 'Logistics & Promotion',
                        type: 'text',
                        content: 'Secure a venue, recruit volunteers, and create buzz on campus. Build a simple run-of-show document, assign clear roles to your volunteer team, and create a promotion timeline that starts at least two weeks before the event date.'
                    },
                    {
                        order: 3,
                        title: 'Post-Event Recap',
                        type: 'text',
                        content: 'Collect feedback, calculate impact, and report results back to the AZ Learner team. Use a short NPS survey to measure satisfaction, count new sign-ups attributed to the event, and document lessons learned so future events are even better.'
                    }
                ]
            }
        ];

        window.authManager = {
            async login() {
                const email = document.getElementById('login-email').value;
                const pass = document.getElementById('login-pass').value;
                const msg = document.getElementById('login-msg');

                if (!email || !pass) {
                    msg.innerText = 'Please enter email and password';
                    return;
                }

                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, pass);
                    // Auth state change handler will take care of the rest
                } catch (error) {
                    msg.innerText = 'Invalid credentials';
                    console.error('Login error:', error);
                }
            },

            async logout() {
                await signOut(auth);
                location.reload();
            }
        };

        window.portal = {
            init() {
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        // Check if user is admin or ambassador
                        const userDoc = await getDoc(doc(db, "users", user.uid));
                        
                        if (userDoc.exists()) {
                            const userData = userDoc.data();
                            
                            // Admins are automatically ambassadors
                            if (userData.role === 'admin') {
                                isAmbassador = true;
                                currentUser = { 
                                    ...userData, 
                                    uid: user.uid,
                                    isAdmin: true 
                                };
                                this.showPortal(currentUser);
                                return;
                            }
                        }

                        // Check if user is an approved ambassador
                        const ambassadorQuery = query(
                            collection(db, 'ambassadors'),
                            where('email', '==', user.email)
                        );
                        const ambassadorSnap = await getDocs(ambassadorQuery);

                        if (!ambassadorSnap.empty) {
                            isAmbassador = true;
                            const ambassadorData = ambassadorSnap.docs[0].data();
                            currentUser = { 
                                ...ambassadorData, 
                                uid: user.uid,
                                isAdmin: false 
                            };
                            this.showPortal(currentUser);
                        } else {
                            alert('Access Denied: You are not an approved ambassador. Please submit an application at ambassadorsignup.html or contact support for assistance.');
                            signOut(auth);
                        }
                    } else {
                        document.getElementById('auth-overlay').classList.remove('hidden');
                        document.getElementById('app-content').classList.add('hidden');
                    }
                });
            },

            showPortal(userData) {
                document.getElementById('auth-overlay').classList.add('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                
                const displayName = userData.name || userData.fullName || 'Ambassador';
                document.getElementById('user-name-display').innerText = `Welcome, ${displayName}`;
                
                this.loadProfile(userData);
                this.loadPrograms();
                this.loadCourses();
                this.loadLeaderboard();
                this.switchTab('profile');
            },

            loadProfile(userData) {
                // Set initials
                const name = userData.name || userData.fullName || '?';
                const initials = name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                document.getElementById('profile-initials').innerText = initials;
                
                // Set profile data
                document.getElementById('profile-name').innerText = name;
                document.getElementById('profile-email').innerText = userData.email || '-';
                document.getElementById('profile-university').innerText = userData.university || '-';
                document.getElementById('profile-major').innerText = userData.major || '-';
                document.getElementById('profile-year').innerText = userData.year || '-';
                document.getElementById('profile-gpa').innerText = userData.gpa || '-';
                document.getElementById('profile-phone').innerText = userData.phone || '-';
                document.getElementById('profile-dob').innerText = userData.dob || '-';
                document.getElementById('profile-social').innerText = userData.socialMedia || '-';
                
                if (userData.isAdmin) {
                    document.getElementById('profile-role').innerText = 'Admin (Default Ambassador)';
                    document.getElementById('profile-role').classList.remove('bg-orange-900/30', 'text-orange-400');
                    document.getElementById('profile-role').classList.add('bg-purple-900/30', 'text-purple-400');
                    document.getElementById('profile-approved').innerText = 'Admin - Default Ambassador Status';
                } else if (userData.approvedAt && typeof userData.approvedAt.toDate === 'function') {
                    const approvedDate = new Date(userData.approvedAt.toDate()).toLocaleDateString();
                    const approvedBy = userData.approvedBy || 'Admin';
                    document.getElementById('profile-approved').innerText = `Approved on: ${approvedDate} by ${approvedBy}`;
                } else {
                    document.getElementById('profile-approved').innerText = 'Ambassador Status: Active';
                }
            },

            loadPrograms() {
                onSnapshot(
                    query(collection(db, 'ambassador_programs'), orderBy('createdAt', 'desc')),
                    (snap) => {
                        const programsList = document.getElementById('programs-list');
                        programsList.innerHTML = '';
                        
                        if (snap.empty) {
                            programsList.innerHTML = '<div class="text-center text-gray-500 py-8">No programs scheduled yet</div>';
                        } else {
                            document.getElementById('stat-programs').innerText = snap.size;
                            
                            snap.forEach(d => {
                                const prog = d.data();
                                const programDate = new Date(prog.date).toLocaleString();
                                const isPast = new Date(prog.date) < new Date();
                                
                                programsList.innerHTML += `
                                    <div class="bg-gray-800/50 border ${isPast ? 'border-gray-700' : 'border-blue-500/30'} rounded-xl p-6">
                                        <div class="flex justify-between items-start mb-3">
                                            <h3 class="text-xl font-bold text-white">${prog.title}</h3>
                                            <span class="px-3 py-1 rounded-full text-xs font-bold ${isPast ? 'bg-gray-700 text-gray-400' : 'bg-blue-900/30 text-blue-400'}">
                                                ${isPast ? 'Past Event' : 'Upcoming'}
                                            </span>
                                        </div>
                                        <p class="text-gray-300 mb-4">${prog.description}</p>
                                        <div class="flex items-center gap-4 text-sm text-gray-400">
                                            <span><i class="fas fa-calendar"></i> ${programDate}</span>
                                            ${prog.link !== 'TBD' ? `<a href="${prog.link}" target="_blank" class="text-blue-400 hover:underline"><i class="fas fa-link"></i> Join Link</a>` : ''}
                                        </div>
                                    </div>
                                `;
                            });
                        }
                    }
                );
            },

            async loadCourses() {
                const COLOR_CLASSES = {
                    blue:   { bg: 'bg-blue-900/20',   border: 'border-blue-500/30',   iconBg: 'bg-blue-500/20',   icon: 'text-blue-400',   badge: 'text-blue-400'   },
                    orange: { bg: 'bg-orange-900/20', border: 'border-orange-500/30', iconBg: 'bg-orange-500/20', icon: 'text-orange-400', badge: 'text-orange-400' },
                    green:  { bg: 'bg-green-900/20',  border: 'border-green-500/30',  iconBg: 'bg-green-500/20',  icon: 'text-green-400',  badge: 'text-green-400'  },
                    purple: { bg: 'bg-purple-900/20', border: 'border-purple-500/30', iconBg: 'bg-purple-500/20', icon: 'text-purple-400', badge: 'text-purple-400' },
                };

                const coursesGrid = document.getElementById('courses-grid');

                let courses = [];
                try {
                    const snap = await getDocs(
                        query(collection(db, 'courses'), where('isPublished', '==', true))
                    );
                    if (!snap.empty) {
                        snap.forEach(docSnap => courses.push({ id: docSnap.id, ...docSnap.data() }));
                    }
                } catch (e) {
                    console.warn('Firestore courses unavailable, using hardcoded data:', e);
                }

                if (courses.length === 0) {
                    courses = HARDCODED_COURSES;
                }

                coursesGrid.innerHTML = '';
                document.getElementById('stat-courses').innerText = courses.length;

                courses.forEach(c => {
                    const cls = COLOR_CLASSES[c.color] ?? COLOR_CLASSES.blue;

                    const card = document.createElement('div');
                    card.className = `${cls.bg} border ${cls.border} rounded-xl p-6 hover:opacity-90 transition cursor-pointer`;
                    card.addEventListener('click', () => portal.openCourse(c.id, courses));

                    const inner = document.createElement('div');
                    inner.className = 'flex items-start gap-4';

                    const iconWrap = document.createElement('div');
                    iconWrap.className = `${cls.iconBg} p-3 rounded-lg shrink-0`;
                    const icon = document.createElement('i');
                    icon.className = `fas fa-${c.icon} ${cls.icon} text-2xl`;
                    iconWrap.appendChild(icon);

                    const textWrap = document.createElement('div');

                    const title = document.createElement('h3');
                    title.className = 'text-lg font-bold text-white mb-1';
                    title.textContent = c.title;

                    const desc = document.createElement('p');
                    desc.className = 'text-sm text-gray-400 mb-3';
                    desc.textContent = c.description;

                    const metaRow = document.createElement('div');
                    metaRow.className = 'flex items-center gap-3';

                    const badge = document.createElement('span');
                    badge.className = `text-xs ${cls.badge} font-bold`;
                    badge.textContent = c.duration || '';

                    const modCount = document.createElement('span');
                    modCount.className = 'text-xs text-gray-500';
                    modCount.textContent = `${c.modules?.length ?? 0} modules`;

                    metaRow.append(badge, modCount);
                    textWrap.append(title, desc, metaRow);
                    inner.append(iconWrap, textWrap);
                    card.appendChild(inner);
                    coursesGrid.appendChild(card);
                });
            },

            openCourse(courseId, coursesData) {
                const allCourses = coursesData || HARDCODED_COURSES;
                const course = allCourses.find(c => c.id === courseId);
                if (!course) return;

                const COLOR_CLASSES = {
                    blue:   { iconBg: 'bg-blue-500/20',   icon: 'text-blue-400'   },
                    orange: { iconBg: 'bg-orange-500/20', icon: 'text-orange-400' },
                    green:  { iconBg: 'bg-green-500/20',  icon: 'text-green-400'  },
                    purple: { iconBg: 'bg-purple-500/20', icon: 'text-purple-400' },
                };
                const cls = COLOR_CLASSES[course.color] ?? COLOR_CLASSES.blue;

                document.getElementById('course-modal-title').textContent = course.title;
                document.getElementById('course-modal-desc').textContent = course.description;
                document.getElementById('course-modal-icon-wrap').className = `${cls.iconBg} p-3 rounded-lg`;
                document.getElementById('course-modal-icon').className = `fas fa-${course.icon} ${cls.icon} text-2xl`;

                const modulesContainer = document.getElementById('course-modal-modules');
                modulesContainer.innerHTML = '';
                (course.modules || []).forEach(mod => {
                    const item = document.createElement('details');
                    item.className = 'bg-gray-800/50 border border-gray-700 rounded-xl overflow-hidden';

                    const summary = document.createElement('summary');
                    summary.className = 'flex items-center justify-between px-5 py-4 cursor-pointer hover:bg-white/5 transition list-none';
                    summary.innerHTML = `
                        <div class="flex items-center gap-3">
                            <span class="bg-gray-700 text-gray-300 text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full shrink-0">${mod.order}</span>
                            <span class="text-white font-semibold text-sm">${mod.title}</span>
                        </div>
                        <i class="fas fa-chevron-down text-gray-500 text-xs transition-transform"></i>`;

                    const content = document.createElement('div');
                    content.className = 'px-5 pb-5 pt-1 text-gray-400 text-sm leading-relaxed border-t border-gray-700';
                    content.textContent = mod.content;

                    item.append(summary, content);
                    modulesContainer.appendChild(item);
                });

                document.getElementById('course-modal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            },

            closeCourseModal() {
                document.getElementById('course-modal').classList.add('hidden');
                document.body.style.overflow = '';
            },

            async loadLeaderboard() {
                const leaderboardList = document.getElementById('leaderboard-list');
                try {
                    const snap = await getDocs(
                        query(collection(db, 'ambassadors'), orderBy('achievementPoints', 'desc'))
                    );

                    if (snap.empty) {
                        leaderboardList.innerHTML = '<div class="text-center text-gray-500 py-8">No leaderboard data yet</div>';
                        return;
                    }

                    leaderboardList.innerHTML = '';
                    const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];
                    let rank = 0;
                    snap.forEach(d => {
                        rank++;
                        const amb = d.data();
                        const name = amb.name || amb.fullName || 'Ambassador';
                        const pts = amb.achievementPoints ?? 0;
                        const initials = name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();

                        const row = document.createElement('div');
                        row.className = `flex items-center gap-4 p-4 rounded-xl ${rank <= 3 ? 'bg-yellow-900/10 border border-yellow-500/20' : 'bg-gray-800/30 border border-gray-700/50'}`;
                        row.innerHTML = `
                            <span class="text-xl w-8 text-center shrink-0">${medals[rank - 1] || rank}</span>
                            <div class="w-10 h-10 bg-gradient-to-br from-orangeAccent to-orange-600 rounded-full flex items-center justify-center text-sm font-bold shrink-0">${initials}</div>
                            <div class="flex-1 min-w-0">
                                <p class="text-white font-bold text-sm truncate">${name}</p>
                                <p class="text-gray-500 text-xs truncate">${amb.university || ''}</p>
                            </div>
                            <span class="text-yellow-400 font-bold text-sm shrink-0">${pts} pts</span>`;
                        leaderboardList.appendChild(row);
                    });
                } catch (e) {
                    console.warn('Could not load leaderboard:', e);
                    leaderboardList.innerHTML = '<div class="text-center text-gray-500 py-8">Leaderboard unavailable</div>';
                }
            },

            switchTab(tab) {
                // Hide all views
                document.querySelectorAll('.portal-view').forEach(el => el.classList.add('hidden'));
                document.getElementById(`view-${tab}`).classList.remove('hidden');

                // Update tab buttons
                document.querySelectorAll('.portal-tab').forEach(btn => {
                    btn.classList.remove('bg-blueAccent', 'text-white');
                    btn.classList.add('text-gray-400');
                });
                document.getElementById(`tab-${tab}`).classList.remove('text-gray-400');
                document.getElementById(`tab-${tab}`).classList.add('bg-blueAccent', 'text-white');
            }
        };

        window.addEventListener('DOMContentLoaded', () => portal.init());
    </script>
</body>
</html>
